# TODO.md

## プロジェクト進行状況

### フェーズ1: 基本機能実装 ✅ 完了

#### プロジェクト初期設定
- [x] requirements.txtの作成
- [x] 基本ディレクトリ構造の作成
- [x] 設定ファイルテンプレートの作成
- [x] .gitignoreの設定

#### LLMモジュール (src/llm/)
- [x] LM Studio API接続クラスの実装
- [x] プロンプトテンプレート管理
- [x] 検索判断機能の実装
- [x] 検索クエリ生成機能の実装
- [x] 結果要約機能の実装
- [x] エラーハンドリングの実装

#### スクレイピングモジュール (src/scraper/)
- [x] Bing検索URL生成
- [x] HTMLパース・データ抽出
- [x] レート制限機能（1秒間隔）
- [x] User-Agent設定
- [x] エラーハンドリング・リトライ機能
- [x] 検索結果の構造化

#### キャッシュモジュール (src/cache/)
- [x] SQLiteデータベース設計
- [x] キャッシュテーブル作成
- [x] キャッシュ読み書き機能
- [x] TTL（24時間）管理
- [x] 重複チェック機能

#### CLIモジュール (src/cli/)
- [x] コマンドライン引数解析
- [x] メイン処理フローの実装
- [x] 進捗表示機能
- [x] 設定読み込み機能
- [x] ログ出力設定

#### ユーティリティ (src/utils/)
- [x] 共通設定管理
- [x] ログ設定
- [x] 例外処理クラス
- [x] 設定ファイル管理

### フェーズ2: 機能拡張 📋

#### 統合テストと修正 ✅ 完了
- [x] 依存関係とインポートの修正
- [x] 設定ファイルの動作確認
- [x] CLIコマンドの動作テスト
- [x] エラーハンドリングの検証
- [x] ドキュメント整備（README.md作成）

#### テスト実装
- [ ] ユニットテスト作成
- [ ] モックテスト（LLM、スクレイピング）
- [ ] 統合テスト
- [ ] pytest設定

#### 設定・運用改善
- [x] 設定ファイルバリデーション
- [x] ログレベル設定
- [x] デバッグモード実装
- [ ] パフォーマンス最適化

#### UI/UX改善
- [x] プログレスバー表示
- [ ] カラー出力対応
- [x] ヘルプメッセージ改善
- [x] エラーメッセージ改善

### フェーズ3: 高度な機能 🎯

#### 履歴・メモリ機能
- [ ] チャット履歴テーブル設計
- [ ] 履歴保存機能
- [ ] コンテキスト付き回答生成
- [ ] 履歴検索機能

#### 検索機能拡張 🚀 一部完了
- [x] **DuckDuckGo検索エンジン実装** ✅ 完了
- [x] **Brave検索エンジン実装** ✅ 完了  
- [x] **フォールバック機能** ✅ 完了
- [ ] Google検索エンジン追加
- [ ] 検索API統合（Bing Search API等）
- [ ] 検索結果の信頼性スコア
- [ ] 関連検索提案
- [ ] 検索結果のランキング

#### システム改善
- [ ] 非同期処理対応
- [ ] 設定GUI（オプション）
- [ ] プラグインシステム
- [ ] API化（将来的）

### フェーズ4: 次世代機能 🚀

#### 個別サイトコンテンツ取得機能
- [ ] **Wikipedia専用スクレイパー実装**
  - Wikipediaページの全文取得
  - 構造化データ抽出（経歴、データボックス等）
  - 日本語・英語両対応
- [ ] **ニュースサイト専用スクレイパー実装**
  - 主要ニュースサイト対応（NHK、読売、朝日、毎日等）
  - 記事本文の正確な抽出
  - 発行日時・著者情報取得
- [ ] **新聞サイト専用スクレイパー実装**
  - 新聞社サイトの記事取得
  - paywall回避不可記事の判定
  - メタデータ抽出
- [ ] **信頼できるサイト判定機能**
  - ドメインベースの信頼性スコア
  - 公式サイト・政府機関サイト優先
  - 不適切サイトのフィルタリング

#### 高度な検索戦略機能
- [ ] **複数クエリ戦略実装**
  - LLMによる関連クエリ自動生成
  - 段階的クエリ拡張（一般→詳細）
  - キーワード組み合わせ最適化
- [ ] **検索結果品質評価システム**
  - LLMによる結果充足度判定
  - 「情報不足」の自動検出
  - 追加検索必要性の判断
- [ ] **適応的追加検索機能**
  - 初回検索結果の分析
  - 不足情報の特定
  - ターゲット絞り込み追加検索
- [ ] **複合情報統合機能**
  - 複数ソースからの情報統合
  - 矛盾情報の検出・整理
  - 情報の信頼性重み付け

#### 情報品質向上機能
- [ ] **情報検証・クロスチェック**
  - 複数ソースでの事実確認
  - 情報の新しさチェック
  - 相互参照による信頼性向上
- [ ] **リアルタイム情報取得**
  - 最新ニュース優先取得
  - 時系列情報の整理
  - 情報の鮮度管理
- [ ] **専門分野対応強化**
  - 分野別信頼サイトデータベース
  - 学術論文・公式文書優先
  - 専門用語辞書連携

## 技術的課題

### 優先度: 高 🔥
- [x] LM Studio接続の安定性確保
- [x] **代替検索エンジン実装による検索問題解決** ✅ 完了
  - DuckDuckGo: 主要検索エンジンとして実装完了
  - Brave: フォールバック検索エンジンとして実装完了
  - Bing: Bot検出により廃止、代替手段で解決
- [x] 日本語文字化け対策
- [x] **エンコーディング問題解決** ✅ 完了

### 優先度: 中
- [ ] 大量データ処理時のメモリ効率化
- [ ] 長時間実行時の安定性
- [ ] 複数モデル対応

### 優先度: 低
- [ ] 国際化対応
- [ ] 設定のクラウド同期
- [ ] 統計・分析機能

## システム動作状況 🟢

### 検索エンジン
- **DuckDuckGo**: ✅ 完全動作（主要エンジン）
- **Brave**: ✅ 完全動作（フォールバック）
- **~~Bing~~**: ❌ Bot検出により廃止

### コアシステム
- **LM Studio連携**: ✅ 完全動作
- **キャッシュシステム**: ✅ 完全動作
- **CLI機能**: ✅ 完全動作
- **エラーハンドリング**: ✅ 堅牢な実装
- **検索判断・要約**: ✅ 完全動作

### 新機能
- **フォールバック機能**: ✅ 主要エンジン失敗時の自動切り替え
- **エンコーディング対応**: ✅ 文字化け問題解決

## 完了したタスク ✅

### フェーズ1: 基本機能実装
- プロジェクト初期セットアップ（設定ファイル、ディレクトリ構造）
- LM Studio API連携とプロンプト管理
- ~~Bingスクレイピング基盤（技術的制限あり）~~ → DuckDuckGo/Braveに移行
- SQLiteキャッシュシステム
- CLI インターフェース
- 統合エラーハンドリング

### 統合テスト
- 依存関係解決
- 全機能動作確認
- ドキュメント作成
- Git管理開始

### 検索エンジン改良（2024年6月）
- **DuckDuckGo検索エンジン実装**: 主要検索エンジンとして完全実装
- **Brave検索エンジン実装**: フォールバック機能として実装
- **フォールバック機能**: 主要エンジン失敗時の自動切り替え
- **エンコーディング問題解決**: Accept-Encoding制御とレスポンス処理改善
- **Bing廃止**: Bot検出対策として代替エンジンに完全移行
- **検索テスト**: 複数クエリでの動作検証完了